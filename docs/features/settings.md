# F09: 設定・アクセシビリティ

最終更新: 2025-09-02 (Asia/Tokyo)

> アプリの各種設定（アカウント、通知、プライバシー、表示など）をユーザーが管理・カスタマイズするための機能。

---

## 1. 目的
- ユーザーが自身の好みに合わせてアプリの体験を最適化できるようにする。
- プライバシーや通知に関するコントロールを提供し、ユーザーに安心感を与える。
- アプリの基本的な情報（利用規約など）へのアクセスを提供する。

---

## 2. 機能概要
アプリ内に「設定」画面を設け、以下のような多岐にわたる設定項目へのアクセスを提供する。
- アカウント情報の管理
- 通知のON/OFF（F06連携）
- プライバシー関連の設定（F08連携）
- SNS連携の管理（F07連携）
- 表示とアクセシビリティ（ダークモード、言語など）

---

## 3. 設定項目の詳細

### 3.1 アカウント
- **プロフィール編集**: 表示名、アイコン画像を変更できる。
- **メールアドレス**: 登録されているメールアドレスの表示と変更。
- **アカウント削除**: アカウントを完全に削除するための導線。（`DELETE /me` を呼び出す）

### 3.2 通知 (F06連携)
- **すべての通知**: アプリからの全プッシュ通知を一度にON/OFFできるトグル。
- **通知のカスタマイズ**:
  - 新しい提案
  - 提案へのリアクション
  - 新着メッセージ
  - 日程のリマインダー
  - 上記の項目ごとに通知をON/OFFできる。

### 3.3 プライバシー (F08連携)
- **ブロック中のユーザー**: 自分がブロックしているユーザーの一覧を表示する。ここからブロックの解除も行える。

### 3.4 連携済みアカウント (F07連携)
- **SNS連携**: 現在連携しているSNSアカウント（X, Facebookなど）を表示し、連携を解除する機能を提供する。

### 3.5 表示とアクセシビリティ
- **テーマ**: アプリの外観モードを選択する。
  - ライトモード
  - ダークモード
  - システム設定に合わせる
- **言語 (Language)**: アプリ内で使用する言語を切り替える。（例: 日本語, English）

### 3.6 このアプリについて
- **プライバシーポリシー**: プライバシーポリシーのドキュメントへのリンク。
- **利用規約**: 利用規約のドキュメントへのリンク。
- **バージョン**: アプリの現在のバージョン番号を表示する。

---

## 4. API 定義

### 4.1 `GET /users/me/settings`
現在のユーザー設定（通知、テーマなど）を取得します。

### 4.2 `PUT /users/me/settings`
ユーザー設定を更新します。
**Request Body**
```json
{
  "notifications": {
    "all_enabled": true,
    "new_proposal": true,
    "new_message": false
  },
  "display": {
    "theme": "dark",
    "language": "en"
  }
}
```

### 4.3 `PUT /users/me`
プロフィール情報（表示名、アイコン）を更新します。

---

## 5. データモデル

### `user_settings` テーブル (または `users` テーブルにカラム追加)
```sql
CREATE TABLE user_settings (
    user_id BIGINT PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,
    notifications_enabled BOOLEAN DEFAULT true,
    notification_new_proposal BOOLEAN DEFAULT true,
    notification_new_message BOOLEAN DEFAULT true,
    -- etc.
    theme TEXT DEFAULT 'system', -- system, light, dark
    language TEXT DEFAULT 'ja'
);
```

---

## 6. 永続化
- 全ての設定値はサーバーサイドのDBに保存され、ユーザーが再ログインしたり、別のデバイスで利用したりしても引き継がれる。
- テーマ設定などのUIに即時反映が必要な項目は、クライアントサイドのストレージ（MMKVなど）にもキャッシュすることが望ましい。

---

## 7. 受け入れ基準（AC）
- ✅ プロフィール（表示名、アイコン）を変更し、それが他の画面にも反映される。
- ✅ 通知設定を変更でき、実際のプッシュ通知の挙動に反映される。
- ✅ ブロックしているユーザーの一覧が表示され、ブロックを解除できる。
- ✅ テーマ（ダークモードなど）を切り替えると、アプリ全体のUIが即座に切り替わる。
- ✅ 言語を切り替えると、アプリ内のテキストが指定の言語に切り替わる。
- ✅ アカウント削除ボタンを押すと、確認ダイアログが表示された上で、アカウントが削除される。