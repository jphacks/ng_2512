digraph DF {
  rankdir=LR;
  labelloc="t";
  label="Recall 開発タスクフロー（IDのみ）";
  fontname="Helvetica";
  node [shape=box, fontsize=10, fontname="Helvetica"];
  edge [fontsize=9, fontname="Helvetica", arrowsize=0.6];
  graph [splines=ortho, nodesep=0.4, ranksep=0.9, concentrate=false];

  // ========== Dependencies from tasks (edges: dependency -> task) ==========
  // CI/CD
  CI1 -> CI2;
  CI1 -> CI3;
  CI2 -> CI3;
  CI3 -> CI4;
  CI4 -> CI5;
  CI2 -> CI6; CI3 -> CI6;      // CI.6 Mobile Web E2E depends CI.2/CI.3
  // CI先行（環境整備→主要領域の着手）
  CI1 -> FL11; CI1 -> FL12; CI1 -> RN10;
  // Ops依存
  CI2 -> FL51; CI4 -> FL51; CI4 -> FL52;

  // Firebase FB.1.x
  FB11 -> FB12;                  // FB.1.2 depends FB.1.1
  // Break mutual deps: adopt schema-first for presence/friends
  FB13;                          // FB.1.3 (presence schema)
  FB14;                          // FB.1.4 (friendships schema)

  // Firebase FB.2.x Rules
  FB12 -> FB21;                  // FB.2.1 depends FB.1.2
  FB11 -> FB22;                  // FB.2.2 depends FB.1.1
  FB13 -> FB23;                  // FB.2.3 depends FB.1.3

  // Firebase FB.3.x Functions
  FB11 -> FB31; FB22 -> FB31;    // FB.3.1 depends FB.1.1, FB.2.2
  FB11 -> FB32; FB12 -> FB32; FB21 -> FB32; FB22 -> FB32; FB31 -> FB32; // FB.3.2 deps
  FB14 -> FB33; FB21 -> FB33; FB22 -> FB33; FB23 -> FB33; // FB.3.3 deps
  SEC3 -> FB34;                  // FB.3.4 depends SEC.3 (policy first)
  FB11 -> FB36; FB22 -> FB36; FB34 -> FB36; FL33 -> FB36; FL34 -> FB36; FB35 -> FB36; // FB.3.6 depends schema/rules/signed-url/FL.3.3/FL.3.4/FB.3.5
  FB31 -> FB35; FB32 -> FB35; FB33 -> FB35; FB34 -> FB35; // FB.3.5 depends on proposals lifecycle & signed URLs
  FB34 -> FB37; FB35 -> FB37; FL34 -> FB37; // FB.3.7 depends signed-url/notifications/journal API

  // Firebase FB.4.x Auth
  // Break cycle: RN.1.0 should depend on FB.4.0 (Auth), not vice versa
  // RN10 -> FB40;               // removed to avoid RN10<->FB40 cycle

  // Firebase FB.5.x Ops
  FB32 -> FB50; FB35 -> FB50; FB40 -> FB50; // FB.5.0 depends FB.1〜4 (代表)

  // Flask FL.1.x -> FL.2.x
  FL11 -> FL13;                   // FL.1.3 builds on assets schema
  FL11 -> FL14;                   // FL.1.4 builds on asset storage metadata
  FL11 -> FL21; FL12 -> FL21; FL13 -> FL21;    // FL.2.1 depends FL.1.*
  FL11 -> FL22; FL12 -> FL22; FL13 -> FL22;    // FL.2.2 depends FL.1.*
  FL21 -> FL23; FL22 -> FL23; FL51 -> FL23; // FL.2.3 depends FL.2.1/2.2/5.1
  FL13 -> FL24; FL22 -> FL24;      // FL.2.4 journal repo depends on journal schema & asset repo
  FL21 -> FL25; FL22 -> FL25; FL23 -> FL25; FL14 -> FL25; // FL.2.5 depends embeddings/asset/AI/VLM tables

  // Flask FL.3.x APIs
  FL23 -> FL31; FL12 -> FL31;    // FL.3.1 depends FL.2.3, FL.1.2
  FL21 -> FL32; FL23 -> FL32;    // FL.3.2 depends FL.2.1, FL.2.3
  FL23 -> FL33; FL12 -> FL33;    // FL.3.3 depends FL.2.3, FL.1.2
  FL22 -> FL34; FL23 -> FL34; FL24 -> FL34; FL12 -> FL34; // FL.3.4 depends asset repo/service + assets
  FL25 -> FL35; FL22 -> FL35; FL23 -> FL35;               // FL.3.5 depends VLM service + asset + AI

  // Flask FL.4.x Async
  FL11 -> FL40; FL12 -> FL40; FL21 -> FL40; FL22 -> FL40; // FL.4.0 depends FL.1.*, FL.2.*

  // React Native RN.x
  FB40 -> RN10;                  // RN.1.0 depends FB.4.0
  RN10 -> RN11;                  // RN.1.1 builds on Firebase Auth session
  FB11 -> RN11; FB12 -> RN11; FB13 -> RN11; FB14 -> RN11; // RN.1.1 consumes Firestore base schemas
  FB11 -> RN21; FB31 -> RN21;    // RN.2.1 depends FB.1.1, FB.3.1
  FB12 -> RN22; FB21 -> RN22; RN34 -> RN22; // RN.2.2 depends FB.1.2, FB.2.1, RN.3.4
  FB14 -> RN23; FB33 -> RN23;    // RN.2.3 depends FB.1.4, FB.3.3
  FB34 -> RN24; SEC3 -> RN24; RN25 -> RN24; // RN.2.4 depends FB.3.4, SEC.3, completed profile
  FB11 -> RN25; FB31 -> RN25; RN10 -> RN25; RN11 -> RN25; // RN.2.5 depends auth/profile foundations
  RN31 -> RN25; RN32 -> RN25;    // RN.2.5 requires hooks/apiClient integration
  RN33 -> RN26;                  // RN.2.6 depends RN.3.3
  FB35 -> RN26;                  // RN.2.6 depends FB.3.5 (通知設定)
  RN21 -> RN27; RN24 -> RN27; RN25 -> RN27; RN26 -> RN27; RN32 -> RN27; RN33 -> RN27; FL34 -> RN27; FB37 -> RN27; // RN.2.7 depends proposals/upload/profile/settings/API/notifications/api layers
  RN27 -> RN28; RN24 -> RN28; RN32 -> RN28; FL32 -> RN28; FL34 -> RN28; // RN.2.8 depends timeline base, journal upload, apiClient, AI people
  RN27 -> RN29; RN28 -> RN29; RN32 -> RN29; RN33 -> RN29; // RN.2.9 builds on tag suggestions + notifications
  RN27 -> RN210; RN29 -> RN210; RN32 -> RN210; RN40 -> RN210; // RN.2.10 offline sync depends detail edit + platform state
  RN24 -> RN211; RN27 -> RN211; RN28 -> RN211; // RN.2.11 user flow depends upload, timeline, tag suggestions
  RN22 -> RN212; RN31 -> RN212; RN33 -> RN212; // RN.2.12 AI assist depends groups UI, useAuth, notifications
  CI2 -> CI7; FB31 -> CI7; FB35 -> CI7; // CI.7 depends on integration stack & Firebase Functions
  RN10 -> RN31;                  // RN.3.1 depends RN.1.0
  FL31 -> RN32; FL32 -> RN32; FL33 -> RN32; SEC2 -> RN32; // RN.3.2 depends SEC.2, FL.3.*
  FB35 -> RN33;                  // RN.3.3 depends FB.3.5
  FB13 -> RN34; FB23 -> RN34;    // RN.3.4 depends FB.1.3, FB.2.3
  RN10 -> RN40; RN31 -> RN40; RN32 -> RN40; // RN.4.0 builds on auth, hooks, apiClient
  // Demo / Presentation DE.x
  RN21 -> DE10;
  RN26 -> DE10;
  RN32 -> DE10;
  RN33 -> DE10;
  FL33 -> DE10;
  FL34 -> DE10;
  FB35 -> DE10;

  // Final Distribution FIN.x
  CI4 -> FIN10;
  CI5 -> FIN10;
  QA6 -> FIN10;
  FB50 -> FIN10;

  // Security SEC.x (break RN32<->SEC2 cycle: contract-first)
  FB21 -> SEC1; FB22 -> SEC1; FB23 -> SEC1;               // SEC.1 depends FB.2.*
  FL31 -> SEC2; FL32 -> SEC2; FL33 -> SEC2;               // SEC.2 depends FL.3.* (contract)
  SEC2 -> RN32;                                           // RN.3.2 consumes HMAC contract
  // Break cycle: SEC.3 must precede FB.3.4 (policy-first)
  // FB34 -> SEC3;                                        // removed to avoid SEC3<->FB34 cycle
  FL31 -> SEC4; FL32 -> SEC4; FL33 -> SEC4;               // SEC.4 depends FL.3.*

  // QA gates
  FB31 -> QA1; FL23 -> QA1; RN32 -> QA1;                  // QA.1 unit tests depend on Functions/Flask/RN services
  QA1 -> QA2;                                             // Integration follows unit coverage
  CI2 -> QA2; FL31 -> QA2; FL32 -> QA2; FL33 -> QA2; FL34 -> QA2;      // QA.2 depends CI.2, FL.3.*
  RN10 -> QA3; RN21 -> QA3; RN22 -> QA3; FB31 -> QA3; FB32 -> QA3; FB33 -> QA3; FB34 -> QA3; FB35 -> QA3; FB36 -> QA3; FB37 -> QA3; // QA.3 deps
  FL31 -> QA4; FL32 -> QA4; FL33 -> QA4; SEC4 -> QA4;     // QA.4 depends FL.*, SEC.4
  CI5 -> QA4;                                             // 最終性能ゲートに接続
  CI7 -> QA5; RN21 -> QA5; RN22 -> QA5; RN23 -> QA5; RN24 -> QA5; RN25 -> QA5; RN26 -> QA5; RN27 -> QA5; RN28 -> QA5; RN29 -> QA5; RN210 -> QA5; RN211 -> QA5; RN212 -> QA5; RN31 -> QA5; RN32 -> QA5; RN33 -> QA5; RN34 -> QA5;      // QA.5 depends on RN screens/services & mobile compose
  QA2 -> QA6; QA3 -> QA6; QA5 -> QA6; FB11 -> QA6; FB12 -> QA6; FB13 -> QA6; FB14 -> QA6; FB50 -> QA6; FL11 -> QA6; FL12 -> QA6; FL13 -> QA6; FL14 -> QA6; FL51 -> QA6; FL52 -> QA6; FL25 -> QA6; FL35 -> QA6; RN21 -> QA6; RN22 -> QA6; RN23 -> QA6; RN24 -> QA6; RN25 -> QA6; RN26 -> QA6; RN27 -> QA6; RN28 -> QA6; RN29 -> QA6; RN210 -> QA6; RN211 -> QA6; RN212 -> QA6; RN31 -> QA6; RN32 -> QA6; RN33 -> QA6; RN34 -> QA6; RN40 -> QA6; // QA.6 final verification after core RN/FB/FL areas
  RN10 -> QA7; RN11 -> QA7; RN32 -> QA7; RN33 -> QA7;   // QA.7 diagnostics depends on auth + client services

  // Final check (dummy edges from all terminal nodes)
  FIN;
  FIN10 -> FIN [style=dashed, color="gray50"];
  // === status annotations (auto-generated) ===
  CI1 [style="filled,bold", fillcolor="#bbdefb", color="#1565c0"];
  CI2 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  CI3 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  CI4 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  CI5 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  CI6 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  CI7 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FB11 [style="filled", fillcolor="#c8e6c9", color="#2e7d32"];
  FB12 [style="filled", fillcolor="#c8e6c9", color="#2e7d32"];
  FB13 [style="filled", fillcolor="#c8e6c9", color="#2e7d32"];
  FB14 [style="filled", fillcolor="#c8e6c9", color="#2e7d32"];
  FB21 [style="filled,bold", fillcolor="#bbdefb", color="#1565c0"];
  FB22 [style="filled,bold", fillcolor="#bbdefb", color="#1565c0"];
  FB23 [style="filled,bold", fillcolor="#bbdefb", color="#1565c0"];
  FB31 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FB32 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FB33 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FB34 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FB35 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FB36 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FB37 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FB40 [style="filled,bold", fillcolor="#bbdefb", color="#1565c0"];
  FB50 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL11 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL12 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL13 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL14 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL21 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL22 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL23 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL24 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL25 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL31 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL32 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL33 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL34 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL35 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL40 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL51 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  FL52 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  QA1 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  QA2 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  QA3 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  QA4 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  QA5 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  QA6 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  QA7 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN10 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN11 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN21 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN22 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN23 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN24 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN25 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN26 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN27 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN28 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN29 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN31 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN32 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN33 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN34 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  RN40 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  SEC1 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  SEC2 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
  SEC3 [style="filled,bold", fillcolor="#bbdefb", color="#1565c0"];
  SEC4 [style="filled", fillcolor="#eeeeee", color="#9e9e9e"];
}
